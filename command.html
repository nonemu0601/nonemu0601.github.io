<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0b0d12;
      --panel:#121623;
      --panel2:#0f1420;
      --text:#e9eefc;
      --muted:#a9b3cc;
      --line:#24304a;
      --accent:#6ea8ff;
      --danger:#ff6b6b;
      --ok:#51d18a;
      --warn:#ffd166;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, #121a35 0%, var(--bg) 55%);
      color:var(--text);
      padding:20px;
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
    }
    .card{
      background: linear-gradient(180deg, rgba(18,22,35,.95), rgba(15,20,32,.95));
      border:1px solid rgba(36,48,74,.75);
      border-radius:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding:12px 14px;
      border-bottom:1px solid rgba(36,48,74,.6);
      align-items:center;
      justify-content:space-between;
    }
    .toolbar .left, .toolbar .right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .toolbar input{
      width:260px;
      max-width:70vw;
    }
    input, select{
      width:100%;
      background: rgba(10,12,18,.7);
      color: var(--text);
      border:1px solid rgba(36,48,74,.8);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
    }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
    }
    .cardBody{padding:14px}
    button{
      border:0;
      border-radius:12px;
      padding:10px 12px;
      color:#0b0d12;
      background: var(--accent);
      cursor:pointer;
      font-weight:700;
    }
    button.secondary{
      background: transparent;
      color: var(--text);
      border:1px solid rgba(36,48,74,.9);
    }
    button.danger{
      background: transparent;
      color: var(--danger);
      border:1px solid rgba(255,107,107,.75);
    }
    .count{
      font-size:12px;
      color:var(--muted);
    }
    .list{
      padding:10px 10px 14px 10px;
    }
    .item{
      border:1px solid rgba(36,48,74,.7);
      background: rgba(10,12,18,.5);
      border-radius:14px;
      padding:12px;
      margin:10px 4px;
    }
    .itemTop{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .itemTitle{
      font-weight:800;
      font-size:14px;
      margin:0 0 6px 0;
      line-height:1.3;
    }
    .meta{
      font-size:12px;
      color:var(--muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(36,48,74,.7);
      background: rgba(18,22,35,.55);
      color: var(--text);
      font-size:12px;
    }
    .cmdBox{
      margin-top:10px;
      padding:10px;
      border-radius:12px;
      border:1px solid rgba(36,48,74,.7);
      background: rgba(8,10,16,.7);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12.5px;
      white-space:pre-wrap;
      word-break:break-word;
      line-height:1.55;
    }
    .desc{
      margin-top:10px;
      font-size:12.5px;
      color: var(--text);
      opacity:.9;
      line-height:1.65;
      white-space:pre-wrap;
      word-break:break-word;
    }
    .itemBtns{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .pill{
      font-size:11px;
      color:var(--muted);
    }
    .toast{
      position:fixed;
      right:14px;
      bottom:14px;
      background: rgba(18,22,35,.95);
      border:1px solid rgba(36,48,74,.85);
      border-radius:14px;
      padding:10px 12px;
      color: var(--text);
      font-size:12px;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      opacity:0;
      transform: translateY(8px);
      transition: opacity .15s ease, transform .15s ease;
      pointer-events:none;
      max-width:min(520px, 92vw);
      line-height:1.55;
    }
    .toast.show{
      opacity:1;
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" style="margin-bottom:16px;">
      <div class="cardBody" style="padding:14px;">
        <label for="title">名前</label>
        <input id="title" placeholder="例: git で直前コミットを修正" />
        
        <label for="command" style="margin-top:10px;">コマンド</label>
        <input id="command" placeholder="例: git commit --amend" />
        
        <div style="margin-top:12px;">
          <button id="addBtn">追加</button>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="list" id="list"></div>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <script>
    const STORAGE_KEY = "cmd_memo_items_v1";
    const $ = (id) => document.getElementById(id);

    const state = {
      items: [],
      toastTimer: null
    };

    function nowTs() {
      return Date.now();
    }

    function load() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const v = JSON.parse(raw);
        if (!Array.isArray(v)) return [];
        return v.filter(x => x && typeof x === "object");
      } catch {
        return [];
      }
    }

    function formatDate(ts) {
      const d = new Date(ts);
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const mm = String(d.getMinutes()).padStart(2, "0");
      return `${y}-${m}-${day} ${hh}:${mm}`;
    }

    function toast(msg) {
      const el = $("toast");
      el.textContent = msg;
      el.classList.add("show");
      clearTimeout(state.toastTimer);
      state.toastTimer = setTimeout(() => el.classList.remove("show"), 1800);
    }

    function copyText(text) {
      navigator.clipboard.writeText(text).then(
        () => toast("コピーしました"),
        () => toast("コピーに失敗しました")
      );
    }

    function renderList() {
      const items = [...state.items];

      const root = $("list");
      root.innerHTML = "";

      if (items.length === 0) {
        const empty = document.createElement("div");
        empty.style.padding = "20px";
        empty.style.textAlign = "center";
        empty.style.color = "var(--muted)";
        empty.textContent = "まだメモがありません";
        root.appendChild(empty);
        return;
      }

      items.forEach(it => {
        const box = document.createElement("div");
        box.className = "item";

        const top = document.createElement("div");
        top.className = "itemTop";

        const left = document.createElement("div");
        left.style.minWidth = "0";

        const title = document.createElement("div");
        title.className = "itemTitle";
        title.textContent = it.title || "(no title)";

        const meta = document.createElement("div");
        meta.className = "meta";

        if ((it.category || "").trim()) {
          const t = document.createElement("span");
          t.className = "tag";
          t.textContent = it.category.trim();
          meta.appendChild(t);
        }

        (it.tags || []).slice(0, 10).forEach(tag => {
          const t = document.createElement("span");
          t.className = "tag";
          t.textContent = "#" + tag;
          meta.appendChild(t);
        });

        left.appendChild(title);
        left.appendChild(meta);

        const right = document.createElement("div");
        right.style.flex = "0 0 auto";
        right.style.display = "flex";
        right.style.gap = "8px";
        right.style.alignItems = "center";

        const copyBtn = document.createElement("button");
        copyBtn.className = "secondary";
        copyBtn.type = "button";
        copyBtn.textContent = "コピー";
        copyBtn.onclick = () => copyText(it.command || "");

        const delBtn = document.createElement("button");
        delBtn.className = "danger";
        delBtn.type = "button";
        delBtn.textContent = "削除";
        delBtn.onclick = () => {
          const ok = confirm("このメモを削除します。よろしいですか？");
          if (ok) {
            state.items = state.items.filter(x => x.id !== it.id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state.items));
            refresh();
            toast("削除しました");
          }
        };

        right.appendChild(copyBtn);
        right.appendChild(delBtn);

        top.appendChild(left);
        top.appendChild(right);

        const cmd = document.createElement("div");
        cmd.className = "cmdBox";
        cmd.textContent = it.command || "";

        const desc = document.createElement("div");
        desc.className = "desc";
        desc.textContent = it.desc || "";

        box.appendChild(top);
        box.appendChild(cmd);
        if ((it.desc || "").trim()) box.appendChild(desc);

        root.appendChild(box);
      });
    }

    function refresh() {
      renderList();
    }

    function bind() {
      $("addBtn").addEventListener("click", () => {
        const title = $("title").value.trim();
        const command = $("command").value.trim();
        
        if (!title) {
          toast("名前を入力してください");
          return;
        }
        if (!command) {
          toast("コマンドを入力してください");
          return;
        }
        
        const ts = nowTs();
        const item = {
          id: Math.random().toString(36).slice(2) + "-" + Math.random().toString(36).slice(2),
          title,
          command,
          category: "",
          tags: [],
          desc: "",
          createdAt: ts,
          updatedAt: ts
        };
        
        state.items = [...state.items, item];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state.items));
        
        $("title").value = "";
        $("command").value = "";
        
        refresh();
        toast("追加しました");
      });

      document.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
          e.preventDefault();
          $("addBtn").click();
        }
      });
    }

    function init() {
      state.items = load();
      bind();
      refresh();
    }

    init();
  </script>
</body>
</html>
